<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Geolocation Navigator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10">

        <h1 class="3xl md:text-4xl font-extrabold text-indigo-700 mb-6 border-b pb-2">
            Map Navigation Console
        </h1>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Map Visualization -->
            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-800">Target Map</h2>
                <div class="relative border-4 border-dashed border-gray-200 rounded-lg overflow-hidden">
                    <!-- The map image from your upload is included here for visual context -->
                    <img id="mapImage" src="egmap.jpg" alt="Simulated Town Map with School, Church, and House" class="w-full h-auto object-cover rounded-md" onerror="this.onerror=null; this.src='https://placehold.co/600x400/38bdf8/ffffff?text=Map+Image+Unavailable'">
                    
                    <!-- NEW: The User Location Pointer -->
                    <!-- Absolute positioning is relative to the container above. -->
                    <div id="userPointer" 
                         class="absolute h-4 w-4 bg-red-600 rounded-full border-2 border-white shadow-xl z-10 hidden" 
                         style="transform: translate(-50%, -50%);">
                    </div>
                </div>
                <p class="text-sm text-gray-500">
                    *The navigation below is based on static coordinates assigned to the features on this map image. The red dot shows your **simulated** position.
                </p>
            </div>

            <!-- Geolocation & Status Display -->
            <div class="space-y-6">
                <h2 class="text-xl font-semibold text-gray-800">Your Real-Time Location</h2>
                
                <div id="statusMessage" class="p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg text-sm font-medium">
                    Waiting for location access...
                </div>

                <div class="bg-gray-50 p-4 rounded-xl space-y-2 shadow-inner">
                    <p class="text-gray-600 font-medium">
                        Latitude: <span id="latDisplay" class="font-mono text-gray-900 ml-2">--</span>
                    </p>
                    <p class="text-gray-600 font-medium">
                        Longitude: <span id="lonDisplay" class="font-mono text-gray-900 ml-2">--</span>
                    </p>
                </div>
                
                <h2 class="text-xl font-semibold text-gray-800 pt-4">Navigation Status</h2>

                <div id="navigationResult" class="p-6 bg-indigo-50 border-l-4 border-indigo-500 rounded-lg shadow-md space-y-3">
                    <p id="closestLandmark" class="text-xl font-bold text-indigo-700">Determining closest landmark...</p>
                    <p id="distanceInfo" class="text-sm text-gray-600">Distance information will appear here.</p>
                </div>

                <button id="refreshButton" class="w-full py-3 mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition duration-150 shadow-lg hidden" onclick="getAndNavigate()">
                    Restart Tracking
                </button>
            </div>

        </div>
    </div>

    <script>
        // FIX: Wrapping the code in an IIFE to prevent "already declared" errors in environments
        // that execute the script block multiple times.
        (() => {
            // Use a high-precision constant for Earth's radius in kilometers
            const R = 6371; // Radius of Earth in km
            
            // NEW: Variable to hold the watch position ID
            let watchID = null;

            // --- Mock Landmarks based on the map image ---
            // The coordinates have been adjusted to create specific distances between the points:
            // - School to House: ~5.0 km
            // - House to Church: ~7.8 km
            // MockX and MockY are normalized coordinates (0-100) used to position the pointer visually on the static image.
            const landmarks = [
                // School (Top Left) - Used as a reference point
                { name: "The Main SCHOOL (Top Left)", lat: 37.7749, lon: -122.4194, mockX: 20, mockY: 20 },
                // Church (Top Right) - Adjusted for 7.8km distance from House
                { name: "The CHURCH (Top Right)", lat: 37.7899, lon: -122.3944, mockX: 80, mockY: 20 },
                // Private House (Bottom Center) - Adjusted for 5km distance from School
                { name: "The PRIVATE HOUSE (Bottom Center)", lat: 37.7449, lon: -122.4544, mockX: 50, mockY: 80 }
            ];

            // --- DOM Elements ---
            const statusMessage = document.getElementById('statusMessage');
            const latDisplay = document.getElementById('latDisplay');
            const lonDisplay = document.getElementById('lonDisplay');
            const closestLandmark = document.getElementById('closestLandmark');
            const distanceInfo = document.getElementById('distanceInfo');
            const refreshButton = document.getElementById('refreshButton');
            const navigationResult = document.getElementById('navigationResult');
            const userPointer = document.getElementById('userPointer');

            // Helper function for Haversine distance calculation
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const degToRad = (deg) => deg * (Math.PI / 180);

                const dLat = degToRad(lat2 - lat1);
                const dLon = degToRad(lon2 - lon1);

                const a = 
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(degToRad(lat1)) * Math.cos(degToRad(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                
                // Distance in kilometers
                return R * c; 
            }

            // Core navigation logic
            function navigate(userLat, userLon) {
                // Change to 7 digits of precision as requested
                latDisplay.textContent = userLat.toFixed(7);
                lonDisplay.textContent = userLon.toFixed(7);

                let closestDist = Infinity;
                let closestName = "N/A";
                
                let totalWeight = 0;
                let weightedMockX = 0;
                let weightedMockY = 0;

                // Find the closest landmark and calculate weighted position for the pointer
                landmarks.forEach(landmark => {
                    const distance = calculateDistance(userLat, userLon, landmark.lat, landmark.lon);
                    
                    // Weight is inverse of distance (plus a small epsilon to prevent division by zero)
                    const weight = 1 / (distance + 0.001); 

                    weightedMockX += landmark.mockX * weight;
                    weightedMockY += landmark.mockY * weight;
                    totalWeight += weight;
                    
                    if (distance < closestDist) {
                        closestDist = distance;
                        closestName = landmark.name;
                    }
                });
                
                // Calculate the final mock position (normalized 0-100)
                const pointerX = weightedMockX / totalWeight;
                const pointerY = weightedMockY / totalWeight;

                // Update UI with navigation results
                const distanceString = closestDist.toFixed(3) + " km";
                
                closestLandmark.textContent = `You are closest to: ${closestName}`;
                distanceInfo.textContent = `Current distance to this landmark is approximately ${distanceString}.`;

                // NEW: Update the visual pointer position
                userPointer.style.left = `${pointerX}%`;
                userPointer.style.top = `${pointerY}%`;
                userPointer.classList.remove('hidden'); 

                // Change status message to success
                statusMessage.className = 'p-3 bg-green-100 border border-green-300 text-green-800 rounded-lg text-sm font-medium';
                statusMessage.textContent = 'Live location tracking active.';
                navigationResult.classList.remove('border-indigo-500', 'bg-indigo-50');
                navigationResult.classList.add('border-green-500', 'bg-green-50');
                refreshButton.classList.remove('hidden'); // Show restart tracking button
            }

            // Geolocation success callback
            function success(pos) {
                const crd = pos.coords;
                // This function is called every time watchPosition detects a movement
                navigate(crd.latitude, crd.longitude);
            }

            // Geolocation error callback
            function error(err) {
                console.warn(`ERROR(${err.code}): ${err.message}`);
                
                statusMessage.className = 'p-3 bg-red-100 border border-red-300 text-red-800 rounded-lg text-sm font-medium';
                
                let errorMessage = "Could not get location.";
                if (err.code === 1) {
                    errorMessage = "Access Denied: Please enable location services for this site.";
                } else if (err.code === 2) {
                    errorMessage = "Position Unavailable: GPS signal lost or weak.";
                }

                statusMessage.textContent = `Error: ${errorMessage}. Please press 'Restart Tracking'.`;
                closestLandmark.textContent = "Navigation Failed";
                distanceInfo.textContent = "Cannot calculate proximity without location data.";
                
                navigationResult.classList.remove('border-indigo-500', 'bg-indigo-50');
                navigationResult.classList.add('border-red-500', 'bg-red-50');
                refreshButton.classList.remove('hidden'); // Show restart tracking button
                
                userPointer.classList.add('hidden'); // Hide the pointer on error
            }

            // Main function to get location and start continuous tracking
            // This function needs to remain accessible globally because it's used in the HTML onclick attribute.
            window.getAndNavigate = function() {
                // Clear any existing watch to prevent multiple watches running simultaneously
                if (watchID !== null) {
                    navigator.geolocation.clearWatch(watchID);
                }

                // Reset status message
                statusMessage.className = 'p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg text-sm font-medium';
                statusMessage.textContent = 'Attempting to track your live location...';
                
                // Set options for high accuracy and timeout
                const options = {
                    enableHighAccuracy: true,
                    // Timeout refers to how long it can take to get the *first* reading.
                    timeout: 10000, 
                    maximumAge: 0 // Force a new reading every time
                };

                // Request continuous position tracking
                if (navigator.geolocation) {
                    // Use watchPosition for continuous updates
                    watchID = navigator.geolocation.watchPosition(success, error, options);
                } else {
                    statusMessage.className = 'p-3 bg-red-100 border border-red-300 text-red-800 rounded-lg text-sm font-medium';
                    statusMessage.textContent = 'Error: Geolocation is not supported by this browser.';
                    refreshButton.classList.add('hidden');
                    userPointer.classList.add('hidden');
                }
            }

            // Initialize on load
            window.onload = window.getAndNavigate;
        })();
    </script>
    // Select all nav items
const navItems = document.querySelectorAll('.nav-item');

// Remove 'active' from all and add to clicked one
navItems.forEach(item => {
    item.addEventListener('click', () => {
        navItems.forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');
    });
});

// Navigation Logic
document.getElementById('homeBtn').addEventListener('click', () => {
    window.location.href = 'home.html';
});

document.getElementById('dashboardBtn').addEventListener('click', () => {
    window.location.href = 'dashboard.html';
});

document.getElementById('mapBtn').addEventListener('click', () => {
    window.location.href = 'map.html';
});

document.getElementById('notificationBtn').addEventListener('click', () => {
    window.location.href = 'notifications.html';
});

document.getElementById('profileBtn').addEventListener('click', () => {
    window.location.href = 'profile.html';
});

    
</body>
<body>
    <div class="container">
        <header>
            <h1>üìç Campus Navigation Hub</h1>
            <p>Seamless Navigation Across Campus Facilities</p>
        </header>

        <div class="search-bar">
            <input type="text" placeholder="Search locations, events, or campus services...">
        </div>

        <main>
            <!-- Your existing content sections remain here -->
        </main>

        <!-- Bottom Navigation -->
        <nav>
            <div class="nav-item" id="homeBtn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" id="dashboardBtn">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" id="mapBtn">
                <i class="fas fa-map-location-dot"></i>
                <span>Campus Map</span>
            </div>
            <div class="nav-item" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
                <div class="badge">2</div>
            </div>
            <div class="nav-item" id="profileBtn">
                <i class="fas fa-user"></i>
                <span>User Profile</span>
            </div>
        </nav>
    </div>

    <script src="script.js"></script>
</body>

</html>